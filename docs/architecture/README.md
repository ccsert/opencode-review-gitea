# OpenCode Review Platform - æ¶æ„è®¾è®¡æ–‡æ¡£

> æœ¬æ–‡æ¡£æè¿° OpenCode Review Platform çš„æ•´ä½“æ¶æ„è®¾è®¡ï¼Œç”¨äºæŒ‡å¯¼å¼€å‘å®ç°ã€‚

## ç›®å½•

- [é¡¹ç›®æ„¿æ™¯](#é¡¹ç›®æ„¿æ™¯)
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [æ¨¡å—è®¾è®¡](#æ¨¡å—è®¾è®¡)
- [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)

## é¡¹ç›®æ„¿æ™¯

å°† opencode-review-gitea ä»å•ä¸€çš„ CLI å·¥å…·æ¼”è¿›ä¸º**å¯è§†åŒ– AI Code Review å¹³å°**ï¼š

- âœ… **Web ç®¡ç†ç•Œé¢** - å¯è§†åŒ–é…ç½®ä»“åº“ã€æ¨¡æ¿ã€æŸ¥çœ‹å®¡æŸ¥å†å²
- âœ… **Webhook æœåŠ¡æ¨¡å¼** - ç‹¬ç«‹éƒ¨ç½²ï¼Œæ— éœ€ Gitea Actions Runner
- âœ… **å¤šä»“åº“æ”¯æŒ** - ä¸€ä¸ªå®ä¾‹ç®¡ç†å¤šä¸ªä»“åº“çš„ä»£ç å®¡æŸ¥
- âœ… **è‡ªå®šä¹‰æ¨¡æ¿** - çµæ´»å®šåˆ¶ Review é£æ ¼å’Œå…³æ³¨ç‚¹
- âœ… **å¤šå¹³å°æ‰©å±•** - å½“å‰æ”¯æŒ Giteaï¼Œé¢„ç•™ GitHub/GitLab æ¥å£

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           OpenCode Review Platform                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Web UI     â”‚    â”‚   REST API   â”‚    â”‚   Webhook    â”‚              â”‚
â”‚  â”‚   (React)    â”‚â—„â”€â”€â–ºâ”‚   (Hono)     â”‚â—„â”€â”€â–ºâ”‚   Handler    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                              â”‚                    â”‚                      â”‚
â”‚                              â–¼                    â–¼                      â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                      â”‚         Core Library              â”‚               â”‚
â”‚                      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚               â”‚
â”‚                      â”‚  â”‚Provider â”‚  â”‚Review Engineâ”‚   â”‚               â”‚
â”‚                      â”‚  â”‚ Layer   â”‚  â”‚(OpenCode SDK)â”‚  â”‚               â”‚
â”‚                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚               â”‚
â”‚                      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚               â”‚
â”‚                      â”‚  â”‚Template â”‚  â”‚  Event      â”‚   â”‚               â”‚
â”‚                      â”‚  â”‚ System  â”‚  â”‚  Processor  â”‚   â”‚               â”‚
â”‚                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚               â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                              â”‚                                           â”‚
â”‚                              â–¼                                           â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                      â”‚      Database (Drizzle ORM)      â”‚               â”‚
â”‚                      â”‚    SQLite â”‚ PostgreSQL           â”‚               â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              Git Platforms                 â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
              â”‚  â”‚  Gitea  â”‚  â”‚ GitHub  â”‚  â”‚ GitLab  â”‚   â”‚
              â”‚  â”‚   âœ…    â”‚  â”‚  ğŸ”œ    â”‚  â”‚   ğŸ”œ   â”‚   â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|----------|------|
| **å‰ç«¯** | React 18 + Vite | ç°ä»£åŒ–æ„å»ºï¼Œå¿«é€Ÿå¼€å‘ |
| **UI ç»„ä»¶** | Shadcn/UI + TailwindCSS | æ— å¤´ç»„ä»¶ï¼Œé«˜åº¦å¯å®šåˆ¶ |
| **åç«¯** | Hono + Bun | è½»é‡é«˜æ•ˆï¼Œä¸ç°æœ‰ç”Ÿæ€ä¸€è‡´ |
| **æ•°æ®åº“** | Drizzle ORM | ç±»å‹å®‰å…¨ï¼Œæ”¯æŒå¤šæ•°æ®åº“ |
| **å­˜å‚¨** | SQLite / PostgreSQL | çµæ´»é€‰æ‹©ï¼Œé»˜è®¤ SQLite |
| **AI é›†æˆ** | @opencode-ai/sdk | å®˜æ–¹ SDKï¼Œç±»å‹å®‰å…¨ |
| **è®¤è¯** | JWT + API Key | åŒæ¨¡å¼è®¤è¯ |
| **æ„å»º** | Turborepo | Monorepo ç®¡ç† |
| **éƒ¨ç½²** | Docker | å®¹å™¨åŒ–ä¸€é”®éƒ¨ç½² |

## æ¨¡å—è®¾è®¡

### Monorepo ç»“æ„

```
opencode-review-gitea/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒåº“
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ providers/       # Git å¹³å°é€‚é…å™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts     # Provider æ¥å£å®šä¹‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ base.ts      # æŠ½è±¡åŸºç±»
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ gitea.ts     # Gitea å®ç°
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts     # å·¥å‚å¯¼å‡º
â”‚   â”‚   â”‚   â”œâ”€â”€ events/          # Webhook äº‹ä»¶å¤„ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts     # äº‹ä»¶ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ parser.ts    # Webhook è§£æå™¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ normalizer.ts # äº‹ä»¶æ ‡å‡†åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ review/          # Review å¼•æ“
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ engine.ts    # OpenCode SDK é›†æˆ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ executor.ts  # å®¡æŸ¥æ‰§è¡Œå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ templates/       # æ¨¡æ¿ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts     # æ¨¡æ¿ç±»å‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ defaults.ts  # å†…ç½®æ¨¡æ¿
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ renderer.ts  # æ¨¡æ¿æ¸²æŸ“
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ server/                  # åç«¯ API
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/          # API è·¯ç”±
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts      # è®¤è¯ç›¸å…³
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ repos.ts     # ä»“åº“ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ templates.ts # æ¨¡æ¿ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ reviews.ts   # å®¡æŸ¥å†å²
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ webhooks.ts  # Webhook æ¥æ”¶
â”‚   â”‚   â”‚   â”œâ”€â”€ middleware/      # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts      # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ logger.ts    # æ—¥å¿—ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ db/              # æ•°æ®åº“å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ schema.ts    # Drizzle Schema
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts    # æ•°æ®åº“å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ migrate.ts   # è¿ç§»è„šæœ¬
â”‚   â”‚   â”‚   â”œâ”€â”€ services/        # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ web/                     # å‰ç«¯åº”ç”¨
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ components/      # UI ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ pages/           # é¡µé¢
â”‚       â”‚   â”œâ”€â”€ hooks/           # React Hooks
â”‚       â”‚   â”œâ”€â”€ lib/             # å·¥å…·åº“
â”‚       â”‚   â””â”€â”€ App.tsx
â”‚       â”œâ”€â”€ index.html
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ .opencode-review/            # OpenCode é…ç½®ï¼ˆä¿ç•™å…¼å®¹ï¼‰
â”œâ”€â”€ docker/                      # Docker é…ç½®
â”œâ”€â”€ docs/                        # æ–‡æ¡£
â”œâ”€â”€ turbo.json                   # Turborepo é…ç½®
â””â”€â”€ package.json                 # Workspace root
```

### è¯¦ç»†è®¾è®¡æ–‡æ¡£

- [Provider æŠ½è±¡å±‚è®¾è®¡](./provider-design.md)
- [æ•°æ®åº“è®¾è®¡](./database-design.md)
- [API è®¾è®¡](./api-design.md)
- [è®¤è¯è®¾è®¡](./auth-design.md)
- [æ¨¡æ¿ç³»ç»Ÿè®¾è®¡](./template-design.md)

## éƒ¨ç½²æ¶æ„

### å•å®¹å™¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

```yaml
# docker-compose.yml
services:
  opencode-review:
    image: ghcr.io/ccsert/opencode-review-gitea:latest
    ports:
      - "3000:3000"
    environment:
      - ADMIN_SECRET=your-secret-key
      - DATABASE_URL=file:./data/review.db
      - MODEL=deepseek/deepseek-chat
      - DEEPSEEK_API_KEY=sk-xxx
    volumes:
      - ./data:/app/data
```

### ç”Ÿäº§éƒ¨ç½²ï¼ˆPostgreSQLï¼‰

```yaml
services:
  opencode-review:
    image: ghcr.io/ccsert/opencode-review-gitea:latest
    environment:
      - DATABASE_URL=postgres://user:pass@db:5432/review
      # ...
    depends_on:
      - db

  db:
    image: postgres:16-alpine
    volumes:
      - postgres_data:/var/lib/postgresql/data
```

## å¼€å‘è·¯çº¿å›¾

### Phase 1: åŸºç¡€æ¶æ„ï¼ˆå½“å‰ï¼‰
- [x] åˆ›å»ºå¼€å‘åˆ†æ”¯
- [ ] æ¶æ„æ–‡æ¡£
- [ ] Monorepo åˆå§‹åŒ–
- [ ] æ•°æ®åº“å±‚å®ç°

### Phase 2: æ ¸å¿ƒåŠŸèƒ½
- [ ] Provider æŠ½è±¡å±‚
- [ ] Webhook å¤„ç†
- [ ] Review å¼•æ“é›†æˆ

### Phase 3: Web ç•Œé¢
- [ ] è®¤è¯ç³»ç»Ÿ
- [ ] ä»“åº“ç®¡ç† UI
- [ ] æ¨¡æ¿ç¼–è¾‘å™¨

### Phase 4: éƒ¨ç½²ä¸æ–‡æ¡£
- [ ] Docker é…ç½®
- [ ] README æ›´æ–°
- [ ] éƒ¨ç½²æŒ‡å—
